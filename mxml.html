<!doctype html>
<html>
<head>
<meta charset=utf8>
<title>mxml</title>
<style>
#menu {width:16em;}
#editor {height:32em;border-style:solid;border-width: 1px;border-color:silver;}
.cm-editor { height: 100% }
.cm-scroller { overflow: auto }
</style>
</head>
<body>
<h1>mxml</h1>
<p>
<span><input id="file" type="file" onchange="load();"></span>
<span><label for="menu">View as:</label> <select id="menu" onchange="onmenu();"></select></span>
</p>
<p id="editor"></p>
<script src="mxml.js"></script>
<script>
var editor = new MxmlEditor('editor');
var menu = document.getElementById('menu');
menu.disabled = true;
function add_menu(t, v, b) {
  var o = document.createElement('option');
  o.text = t; o.value = v; o.selected = !!b;
  menu.add(o);
}
editor.notify = function(summary) {
  var i, o;
  for (i = menu.options.length - 1; i >= 0; i--) menu.remove(i);
  if (summary.valid) {
    menu.disabled = false;
    if (summary.type == 'partwise' || summary.type == 'timewise') {
      add_menu('XML (partwise)', 'partwise', summary.type == 'partwise' && !summary.mxl);
      add_menu('MXL (partwise, compressed)', 'zpartwise', summary.type == 'partwise' && summary.mxl);
      add_menu('XML (timewise)', 'timewise', summary.type == 'timewise' && !summary.mxl);
      add_menu('MXL (timewise, compressed)', 'ztimewise' && summary.mxl);
    }
    else if (summary.type == 'opus') {
      add_menu('XML (opus)', 'opus' && !summary.mxl);
      add_menu('MXL (opus, compressed)', 'zopus' && summary.mxl);
    }
  }
  else {
    menu.disabled = true;
  }
};
function load() {
  var reader = new FileReader();
  reader.onload = function(e) { editor.loadData(new Uint8Array(e.target.result)); };
  reader.readAsArrayBuffer(document.getElementById('file').files[0]);
}
function onmenu() {
  //console.log('menu.value', menu.value);
}
</script>
</body>
</html>